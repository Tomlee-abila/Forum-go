<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.6/css/unicons.css">
    <style>@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');


        :root{
            --color-white: hsl(252, 30%, 100%);
            --color-light: hsl(252,30%, 95%);
            --color-gray: hsl(252,15%, 65%);
            --color-primary: hsl(252,75%, 60%);
            --color-secondary: hsl(252,100%, 90%);
            --color-success: hsl(120,95%, 65%);
            --color-danger: hsl(0, 95%, 65%);
            --color-dark: hsl(252,30%, 17%);
            --color-black: hsl(252,30%, 10%);
        
            --border-radius: 2rem;
            --card-border-radius: 1rem;
            --btn-padding: 0.6rem 2rem;
            --search-padding: 0.6rem 1rem;
            --card-padding: 1rem;
        
            --sticky-top-left: 5.4rem;
            --sticky-top-right: -18rem;
        }
        
        
        *, *::before, ::after{
            margin: 0;
            padding: 0;
            outline: 0;
            box-sizing: border-box;
            text-decoration: none;
            list-style: none;
            border: none;
        }
        
        body{
            font-family: "Poppins",sans-serif;
            color: var(--color-dark);
            background: var(--color-light);
            overflow-x: hidden;
        }
        
        /* GENERAL STYLES */
        .container{
            width: 80%;
            margin: 0 auto;
        }

        pre{
            font-family: "Poppins",sans-serif;
        }
        
        .profile-photo{
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            overflow: hidden;
            background-color: #48cae4;
            font-size: 3.5vh;
            color: white; 
        }
        
        .pic{
            background-color: #48cae4;
            border-radius: 50%;
            height: 2.5rem;
            overflow: hidden;
            font-size: 2rem;
            color: white;
            text-transform: uppercase;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            
        }
        
        img{
            display: block;
            width: 100%;
        }
        
        .btn{
            display: inline-block;
            padding: var(--btn-padding);
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 300ms ease;
            font-size: 0.9rem;
        }
        
        .btn:hover{
            opacity: 0.8;
        }
        
        .btn-primary{
            background: var(--color-primary);
            color: white;
        }
        
        .text-bold{
            font-weight: 500;
        }
        
        .text-muted{
            color: var(--color-gray);
        }
        
        /* ========= NAVBAR ========= */
        nav{
            width: 100%;
            background: white;
            padding: 0.7rem 0;
            position: fixed;
            top: 0;
            z-index: 10;
        }
        
        nav .container{
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        nav .search-bar{
            background: var(--color-light);
            border-radius: var(--border-radius);
            padding: var(--search-padding);
        }
        
        nav .search-bar input[type="search"]{
            background: transparent;
            width: 30vw;
            margin-left: 1rem;
            font-size: 0.9rem;
            color: var(--color-dark);
        
        }
        
        nav .search-bar input[type="search"]::placeholder{
            color: var(--color-gray);
        }
        
        
        nav .create{
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        
        /* ==================== MAIN ==================== */
        
        main{
            position: relative;
            top: 5.4rem;
        }
        
        main .container{
            display: grid;
            grid-template-columns: 18vw auto 20vw;
            column-gap: 2rem;
            position: relative;
        }
        
        /* ==================== LEFT ==================== */
        
        main .container .left{
            height: max-content;
            /* position: sticky; */
            /* overflow: auto; */
            top: var(--sticky-top-left);
        }
        
        main .container .left .profile{
            padding: var(--card-padding);
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            display: flex;
            align-items: center;
            column-gap: 1rem;
            width: 100%;
        }
        
        /* ---------------- SIDEBAR ---------------- */
        .left .sidebar{
            margin-top: 1rem;
            background: var(--color-white);
            border-radius: var(--card-border-radius);
        }
        
        .left .sidebar .menu-item{
            display: flex;
            cursor: pointer;
            transition: all 300ms ease;
            position: relative;
        }

        .left .sidebar .menu-item h3, .left .sidebar .menu-item span{
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .left .sidebar .menu-item:hover{
            background: var(--color-light);
        }
        
        .left .sidebar .menu-item i{
            font-size: 1.4rem;
            color: var(--color-gray);
            margin-left: 2rem;
            position: relative;
        }
        
        .left .sidebar i .notification-count{
            background: var(--color-danger);
            color: white;
            font-size: 0.7rem;
            width: fit-content;
            border-radius: 0.8rem;
            padding: 0.1rem 0.4rem;
            position: absolute;
            top: -0.2rem;
            right: -0.3rem;
        }
        
        .left .sidebar h3{
            margin-left: 1.5rem;
            font-size: 1rem;
        }
        
        .left .search-bar .active{
            background: var(--color-light);
        }
        
        .left .search-bar .active i, .left .sidebar .active h3{
            color: var(--color-primary);
        }
        
        .left .sidebar .active::before{
            content: "";
            display: block;
            width: 0.5rem;
            height: 100%;
            position: absolute;
            background: var(--color-primary);
        } 
        
        .left .sidebar .menu-item:first-child.active{
            border-top-left-radius: var(--card-border-radius);
            overflow: hidden;
        }
        
        .left .sidebar .menu-item:last-child.active{
            border-bottom-left-radius: var(--card-border-radius);
            overflow: hidden;
        }
        
        .left .btn{
            margin-top: 1rem;
            width: 100%;
            text-align: center;
            padding: 1rem 0;
        }
        
        /* ==================== MIDDLE ==================== */
        
        /* ------------------- CREATE POST ------------------- */
        .create-post {
            width: 100%;
            align-items: center;
            justify-content: space-between;
            background: var(--color-white);
            padding:  0.4rem var(--card-padding);
            border-radius: var(--card-border-radius);
        }
        
        .create-post .uil{
            color: var(--color-primary);
            font-size: 1.9rem; 
            margin-left: 0rem;
        }
        
        .uil:hover{
            color: var(--color-primary);
            cursor: pointer;
        }

        .create-post div{
            display: flex;    
        }

        .create-post h4{
            margin: 0.5rem;
        }
        
        input[type="text"]{
            justify-self: start;
            width: 70%;
            padding-left: 1rem;
            white-space: pre;
            background: var(--color-secondary);
            border-radius: var(--card-border-radius);
            height: 2.5rem;
            color: var(--color-dark);
        }

        .create-post textarea{
            justify-self: start;
            width: 100%;            
            padding-left: 1rem;
            background: var(--color-secondary);
            border-radius: var(--card-border-radius);
            height: 5rem;
            color: var(--color-dark);
        }
        .middle{
            height: 180vh;
            overflow: auto;
        }
        
        .middle .feeds .feed{
            /* position: relative; */
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            padding: var(--card-padding);
            margin: 1rem 0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .comment_card{
            /* position: absolute; */
            width: 95%;
            margin-left: auto;
            /* background: var(--color-dark); */
            right: 0;
            margin-top: 1rem;            
        }
        
        .middle .feeds .head{
            display: flex;
            justify-content: space-between;
        }
        
        .middle .feed .user{
            display: flex;
            gap: 1rem;
        }
        
        .middle .feed .photo{
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 0.7rem 0;
        }

        
        
        .action-button{
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.4rem;
            margin: 0.6rem;
        }
        
        .reactions{
            background: transparent;
            font-size: large;
            display: flex;
            flex-direction: row;
            margin-right: 8px;
        }

        .reactions:hover{
            cursor: pointer;
        }

        .middle .feed-content{
            margin: 1.2rem;
            color: var(--color-black);
        }
        
        main .container .right{
            height: max-content;        }

        .interaction-buttons{
            display: flex;
        }
        
        .right .heading{
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .category-group{
            display: flex;
            flex-direction: column;
        }
        
        .category-group div{
            display: flex;
            align-items: center;
            padding: 0.8rem;
        }
        
        .category-group div input{
            cursor: pointer;
            margin-right: 1rem;
            
        }
        .category-group div input::after{
            color: var(--color-primary);
            font-size: large;
        
        }
        
        
        .right .categories{
            display: flex;
            flex-direction: column;
            background: var(--color-white);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
            font-size: 1.4rem;
            height: max-content;           
        }

        </style>
</head>
<body>

  <!--========================== NAV BAR ==========================-->
    <nav>
        <div class="container">
            <h2 class="log">
                Forum
            </h2>
            <div class="search-bar">
                <i class="uil uil-search"></i>
                <input type="search" placeholder="Not functional yet">
            </div>

            <div class="create">
              
              <!--====================== LEFT ======================-->
                <label class="btn btn-primary" >Login</label>
                <label class="btn btn-primary" >Register</label>
            </div>
        </div>
    </nav>
  <!--========================== END OF NAV BAR ==========================-->

    <!----------------------- MAIN ----------------------->
    <main>
        <div class="container">
            <!--====================== LEFT ======================-->
            <div class="left">

                <!------------ PROFILE ------------>
                {{ if .UserName}}
                <a class="profile">
                    <div class="profile-photo">
                        <!-- <img src="./images/profile-1.jpg"> -->
                         <!-- {{.Initial}} -->
                          {{.Initial}}
                    </div>
                    <div class="handle">
                        <h4>{{.UserName}}</h4>
                        <p class="text-muted">
                            <!-- @d_akoth -->
                        </p>
                    </div>
                </a>
                {{end}}
            <!------------ END OF PROFILE ------------>


                <!------------- SIDEBAR ------------->
                <div class="sidebar">
                    <a class="menu-item active">
                        <span>
                            <i class="uil uil-home"></i>                            
                        </span>
                        <h3>Home</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-pen"></i></span>  
                        <h3>My Posts</h3>  
                    </a>

                    <a class="menu-item">                     
                        <span><i class="uil uil-thumbs-up"></i></span>
                        <h3>Liked Posts</h3>
                    </a>
                </div>
                <!-------------END OF  SIDEBAR ------------->

                <div class="sidebar">
                    
                    <!------------------- CREATE POST ------------------->
                    <form action="/post" method="POST" id="createPostForm" enctype="multipart/form-data" class="create-post">
                        <h2>create Post</h2>
        
                        <h4>Title</h4>
                        <input type="text" name="post_title" placeholder="Enter title of your post" id="create-post">
                        <h4>Content</h4>
                        <div>
                            <textarea  name="post_content" placeholder="what's on your mind" id="create-post"></textarea>
                        </div>
                        
                        <label for="media"><i class="uil uil-image-plus"></i> </label>
                        <input type="file" id="media" name="media" accept=".jpg,.jpeg,.png,.gif,.mp4,.mov,.webm" hidden>
                        <span id="file-name">No file selected</span>   
                        
                        
                        <h3>Choose the Categories:</h3>
                        <div class="category-group"> 
                            {{range .Categories}}
                            <div class="category-option">                
                                <input type="checkbox" id="cat-{{.ID}}" name="categories" value="{{.Name}}">
                                <label for="cat-{{.ID}}"><h5>{{.Name}}</h5></label>
                            </div>
                            {{end}}                                                
                        </div>
                        <input type="submit" value="Post" class="btn btn-primary">
                    </form>
                    <!------------------- END OF CREATE POST ------------------->
                </div>

        </div>

            <!--====================== END OF LEFT ======================-->



            <!--====================== MIDDLE ======================-->
      <div class="middle">      

        

        <!---------------------- FEEDS/POSTS ---------------------->
                <div class="feeds">
                    {{range .Posts}}
                    <!---------------------- FEED 1 ---------------------->
                    <div class="feed" id="{{.ID}}">

                        <!--======= user  =======-->
                        <div class="head">                            
                            <div class="user">
                                <div class="profile-photo">
                                    <!-- <img src="images/profile-10.jpg"> -->
                                    <p>{{.Initial}}</p>
                                </div>

                                <div class="info">
                                    <h3>{{.UserName}}</h3>
                                    <small> {{.CreatedAt}}</small>
                                </div>                                
                            </div>
                            <span class="edit">                                    
                                <i class="uil uil-ellipsis-h"></i>
                            </span>                            
                        </div>
                        <!--======= END OF user  =======-->

                        
                        <!--======= POST CONTENT  =======-->
                        <div class="feed-content">
                            <h3>{{.Title}}</h3>
                            <pre>{{.Content}}</pre>
                        </div>
                        <!--======= END OF POST CONTENT  =======-->

                        {{if .MediaString}}
                        <!--======= POST IMAGE  =======-->
                        <div class="photo">
                            {{if or (eq .ContentType "image/jpeg") (eq .ContentType "image/png") (eq .ContentType "image/gif")}}
                            <img src="data:{{.ContentType}};base64,{{.MediaString}}" alt="Post image" class="post-media">
                            {{end}}
                        </div>
                        <!--======= END OF POST IMAGE  =======-->
                        {{end}}

                        <div class="action-button">

                            <!------------ LIKES AND DISLIKES ------------>
                            <form class="like-form" action="/likes" method="POST">
                                <div class="interaction-buttons">
                                    <input type="hidden" name="id" value="{{.ID}}">
                                    <input type="hidden" name="item_type" value="post">
                                    <button type="submit" name="type" value="like" class="reactions">
                                        <i class="uil uil-thumbs-up"></i>
                                        <h6 id="" class="like">{{.Likes}}</h6>                                    
                                    </button>
                                    
                                    <button type="submit" name="type" value="dislike" class="reactions">
                                        <i class="uil uil-thumbs-down"></i>
                                        <h6 class="dislike">{{.Dislikes}}</h6>
                                    </button>                                                                                                
                                </div>
                            </form>                         
                            

                            <!--======= comment button =======-->
                            <div class="comment">
                                <span><i class="uil uil-comment-alt-dots" id="{{.ID}}"></i></span>
                                <span>{{.CommentsLenght}}</span>
                            </div>
                            <!--======= END OF comment button =======-->
                        </div>
                            
                        <!------------ END OF LIKES AND DISLIKES ------------>

                       

                        <div class="comments" style="display: none;" id="post-{{.ID}}">
                            <p>Post ID {{.ID}}</p>
                             <!----------------- Comment Form ----------------->
                            <form action="/add_comment" method="POST" class="comment-form" id="comments-{{.ID}}">
                                <input type="hidden" name="post_id" value="{{.ID}}">
                                <input type="text" name="content" placeholder="Add a comment...">    
                                <input type="submit" value="Comment" class="btn btn-primary" >
                            </form>
                            <!----------------- END OF Comment Form ----------------->

                            {{range .Comments}}
                            <div class="comment_card">

                                <!--============== user Profile ==============-->
                                <div class="head">                                    
                                    <div class="user">
                                        <div class="profile-photo">
                                            <!-- <img src="images/profile-10.jpg"> -->
                                            <p>{{.Initial}}</p>
                                        </div>
        
                                        <div class="info">
                                            <h3>{{.UserName}}</h3>
                                            <small>Dubai, 15minute ago</small>
                                        </div>                                
                                    </div>
                                </div>
                                <!--============== End Of user Profile  ==============-->



                                <!--======= comment CONTENT  =======-->
                                <div class="feed-content">
                                    <p>{{.Content}}</p>
                                </div>
                                <!--======= END OF comment CONTENT  =======-->



                                <div class="action-button">

                                    <!------------ LIKES AND DISLIKES ------------>
                                    <form class="like-form" action="/likes" method="POST">
                                        <div class="interaction-buttons">
                                            <input type="hidden" name="id" value="{{.ID}}">
                                            <input type="hidden" name="item_type" value="comment">
                                            <button type="submit" name="type" value="like" class="reactions">
                                                <i class="uil uil-thumbs-up"></i>
                                                <h6 id="" class="like">{{.Likes}}</h6>                                    
                                            </button>
                                            
                                            <button type="submit" name="type" value="dislike" class="reactions">
                                                <i class="uil uil-thumbs-down"></i>
                                                <h6 class="dislike">{{.Dislikes}}</h6>
                                            </button>                                                                                                
                                        </div>
                                    </form>
                                    <span><h6 class="uil reply-btn" id="{{.ID}}">Reply {{.RepliesLenght}}</h6></span>
                                    
                                </div>

                                

                                <div id="reply-{{.ID}}" style="display: none;">
                                    <p>Comment ID {{.ID}}</p>

                                    <form action="/add_reply" method="POST" class="reply-form" id="comments-{{.ID}}">
                                        <input type="hidden" name="parent_comment_id" value="{{.ID}}">
                                        <input type="text" name="content" placeholder="Add a reply...">
                                        <input type="submit" value="Reply" class="btn btn-primary">
                                    </form>


                                    {{range .Replies}}
                                    <div class="comment_card">

                                        <!--============== user Profile ==============-->
                                        <div class="head">                                        
                                            <div class="user">
                                                <div class="profile-photo">
                                                    <!-- <img src="images/profile-10.jpg"> -->
                                                    <p>{{.Initial}}</p>
                                                </div>
                
                                                <div class="info">
                                                    <h3>{{.UserName}}</h3>
                                                    <small>Dubai, 15minute ago</small>
                                                </div>                                
                                            </div>                                   
                                        </div>
                                        <!--============== End OF user Profile ==============-->
                                        

                                        <!--======= comment CONTENT  =======-->
                                        <div class="feed-content">
                                            <p>{{.Content}}</p>
                                        </div>
                                        <!--======= END OF comment CONTENT  =======-->


                                        <div class="action-button">

                                            <!------------ LIKES AND DISLIKES ------------>

                                            <form class="like-form" action="/likes" method="POST">
                                                <div class="interaction-buttons">
                                                    <input type="hidden" name="id" value="{{.ID}}">
                                                    <input type="hidden" name="item_type" value="comment">
                                                    <button type="submit" name="type" value="like" class="reactions">
                                                        <i class="uil uil-thumbs-up"></i>
                                                        <h6 id="" class="like">{{.Likes}}</h6>                                    
                                                    </button>
                                                    
                                                    <button type="submit" name="type" value="dislike" class="reactions">
                                                        <i class="uil uil-thumbs-down"></i>
                                                        <h6 class="dislike">{{.Dislikes}}</h6>
                                                    </button>                                                                                                
                                                </div>
                                            </form>
                                            <span><h6 class="uil reply-btn" id="{{.ID}}">Reply {{.RepliesLenght}}</h6></span>
                                        </div>

                                        <!-- <form action="/add_reply" method="POST" class="reply-form" id="comments-{{.ID}}">
                                            <input type="hidden" name="parent_comment_id" value="{{.ID}}">
                                            <input type="text" name="content" placeholder="Add a comment...">
                                            <input type="submit" value="Reply" class="btn btn-primary">
                                        </form> -->

                                    </div>
                                    {{end}}

                                </div>

                                

                            </div>
                            {{end}}
                        </div>
                        
                    </div>
                    <!---------------------- END OF FEED 1 ---------------------->
                    {{end}}
                </div>
        <!---------------------- END OF FEEDS/POSTS ---------------------->
                        </div>

            <!--====================== RIGHT ======================-->
            <div class="right">

                <div class="categories">
                    <div class="heading">
                        <h4> Filter by categories</h4><i class="uil uil-clipboard-alt"></i>
                    </div>

                    <!---------------------- Categories ---------------------->
                    <div class="category-group">  
                        {{range .Categories}}
                        <div class="category-option">                
                            <input type="checkbox" id="cat-{{.ID}}" name="categories" value="{{.Name}}">
                            <label for="cat-{{.ID}}"><h5>{{.Name}}</h5></label>
                        </div>
                        {{end}}                                               
                    </div>
                    <!---------------------- END OF Categories ---------------------->
                </div>

                
            </div>
            <!--====================== END OF RIGHT ======================-->
        </div>
    </main>
  <!----------------------- END OF MAIN ----------------------->
</body>
<script>
    document.getElementById("media").addEventListener("change", function () {
        let fileName = this.files.length ? this.files[0].name : "No file selected";
        document.getElementById("file-name").textContent = fileName;
    });

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".uil-comment-alt-dots").forEach(icon => {
            icon.addEventListener("click", function () {
                let commentId = this.id; 
                let commentElement = document.getElementById("post-" + commentId);
                console.log("Comment btn clicked and ID = ", commentId)
                
                if (commentElement) {
                    commentElement.style.display = commentElement.style.display === "block" ? "none" : "block";
                }
            });
        });

        document.querySelectorAll(".reply-btn").forEach(btn => {
            btn.addEventListener("click", function () {                
                let replyId = this.id; 
                let replyElement = document.getElementById("reply-" + replyId);
                console.log("reply btn clicked and ID = ", replyId)
                
                if (replyElement) {
                    replyElement.style.display = replyElement.style.display === "block" ? "none" : "block";
                }
            });
        });
        
    });


    // Handle post creation form submission
    document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const response = await fetch('/post', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                console.log('post created')
                alert('Post created successfully!');
                window.location.href = '/allposts';
            } else if (response.status === 401) {
                alert('Failed to create post: user not logged in.');
                window.location.href = '/login';
            } else {
                alert('Failed to create post.');
                // window.location.reload();
            }
        });

        // Handle like/dislike form submissions
        // Like/dislike handler for both posts and comments
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.like-form').forEach(form => {
                form.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const formData = new URLSearchParams();
                    formData.append('id', event.target.querySelector('input[name="id"]').value);
                    formData.append('item_type', event.target.querySelector('input[name="item_type"]').value);
                    formData.append('type', event.submitter.value);

                    try {
                        const response = await fetch('/likes', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: formData
                        });

                        if (response.ok) {
                            //error handling for easy debugging of the code
                            const itemType = event.target.querySelector('input[name="item_type"]').value;
                            const itemId = event.target.querySelector('input[name="id"]').value;
                            const countSpan = document.getElementById(`${event.submitter.value}-count-${itemType}-${itemId}`);

                            if (countSpan) {
                                const currentCount = parseInt(countSpan.textContent);
                                // countSpan.textContent = currentCount + 1;
                                window.location.reload()
                            }
                        } else if (response.status === 401) {
                            window.location.href = '/login';
                        } else {
                            const errorText = await response.text();
                            console.error('Error:', errorText);
                            alert('Failed to process like/dislike');
                        }
                    } catch (error) {
                        console.error('Request failed:', error);
                        alert('Failed to process request');
                    }
                });
            });
        });

        // Handle comment form submissions
        document.querySelectorAll('.comment-form').forEach(form => {
            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const formData = new URLSearchParams(new FormData(event.target));

                try {
                    const response = await fetch('/add_comment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: formData
                    });

                    if (response.ok) {
                        alert('Comment created successfully');
                        window.location.reload();
                    } else if (response.status === 401) {
                        alert('Failed to comment: user not logged in.');
                        window.location.href = '/login';
                    } else {
                        alert('Failed to comment.');
                    }
                } catch (error) {
                    console.error('Request failed:', error);
                }
            });
        });

        // Handle comment form submissions
        document.querySelectorAll('.reply-form').forEach(form => {
            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const formData = new URLSearchParams(new FormData(event.target));

                try {
                    const response = await fetch('/add_reply', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: formData
                    });

                    if (response.ok) {
                        alert('Comment created successfully');
                        window.location.reload();
                    } else if (response.status === 401) {
                        alert('Failed to comment: user not logged in.');
                        window.location.href = '/login';
                    } else {
                        alert('Failed to comment.');
                    }
                } catch (error) {
                    console.error('Request failed:', error);
                }
            });
        });

</script>
</html>