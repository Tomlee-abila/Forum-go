<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <link rel="stylesheet" href="/styling/style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.6/css/unicons.css">
    <!-- <style>

        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

        :root{
            --color-white: hsl(252, 30%, 100%);
            --color-light: hsl(255, 31%, 95%);
            --color-gray: hsl(252,15%, 65%);
            --color-primary: #6b4ce6;
            --color-secondary: hsl(252,100%, 90%);
            --color-success: hsl(120,95%, 65%);
            --color-danger: hsl(0, 95%, 65%);
            --color-dark: hsl(252,30%, 17%);
            --color-black: hsl(252,30%, 10%);
        
            --border-radius: 2rem;
            --card-border-radius: 1rem;
            --btn-padding: 0.6rem 2rem;
            --search-padding: 0.6rem 1rem;
            --card-padding: 1rem;
        
            --sticky-top-left: 5.4rem;
            --sticky-top-right: -18rem;
        }
        
        
        *, *::before, ::after{
            margin: 0;
            padding: 0;
            outline: 0;
            box-sizing: border-box;
            text-decoration: none;
            list-style: none;
            border: none;
        }
        
        body{
            font-family: "Poppins",sans-serif;
            color: var(--color-dark);
            background: var(--color-light);
            overflow-x: hidden;
        }
        .profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;    
            background: white;
            padding: 1rem;
            border-radius: var(--card-border-radius);
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            margin: auto;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 2%;
        }

        .initials {
            font-size: 28px;
            font-weight: bold;
            color: #555;
        }

        .upload-form {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .upload-label {
            cursor: pointer;
            font-size: 14px;
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .upload-label i {
            font-size: 18px;
        }

        input[type="file"] {
            display: none;
        }

        .upload-form button {
            margin-top: 5px;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .upload-form button:hover {
            background-color: #2980b9;
        }

        
        /* GENERAL STYLES */
        .container{
            width: 80%;
            margin: 0 auto;
        }

        pre{
            font-family: "Poppins",sans-serif;
        }
        
        .profile-photo{
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            overflow: hidden;
            background-color: #48cae4;
            font-size: 3.5vh;
            color: var(--color-white); 
        }

        /* .profile-photo {
            min-width: 3rem;
            height: 120px;
            border-radius: 5%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #48cae4;
            cursor: pointer;
            position: relative;
        } */
        
        img{
            display: block;
            width: 100%;
        }
        
        .btn{
            margin-top: 1rem;
            display: inline-block;
            padding: var(--btn-padding);
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 300ms ease;
            font-size: 0.9rem;
        }
        
        .btn:hover{
            opacity: 0.8;
        }
        
        .btn-primary{
            background: var(--color-primary);
            color: var(--color-white);
        }
        
        .text-bold{
            font-weight: 500;
        }
        
        .text-muted{
            color: var(--color-gray);
        }
        
        /* ========= NAVBAR ========= */
        nav{
            width: 100%;
            background: var(--color-white);
            padding: 0.7rem 0;
            position: fixed;
            top: 0;
            z-index: 10;
        }
        
        nav .container{
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        nav .search-bar{
            background: var(--color-light);
            border-radius: var(--border-radius);
            padding: var(--search-padding);
        }
        
        nav .search-bar input[type="search"]{
            background: transparent;
            width: 30vw;
            margin-left: 1rem;
            font-size: 0.9rem;
            color: var(--color-dark);
        
        }
        
        nav .search-bar input[type="search"]::placeholder{
            color: var(--color-gray);
        }
        
        
        nav .create{
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        
        /* ==================== MAIN ==================== */
        
        main{
            position: relative;
            top: 5.4rem;
        }
        
        main .container{
            column-gap: 2rem;

            position: relative;
            /* display: grid;
            grid-template-columns: 18vw auto 20vw; */
           
            display: flex;
            justify-content: center;
        }
        
        /* ==================== LEFT ==================== */
        
        main .container .left{
            height: max-content;
            margin-top: 1rem;
            width: 18vw;
        }
        
        main .container .left .profile{
            padding: var(--card-padding);
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            display: flex;
            align-items: center;
            column-gap: 1rem;
            width: 100%;
        }
        
        /* ---------------- SIDEBAR ---------------- */
        .left .sidebar{
            margin-top: 1rem;
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .left .sidebar .menu-item{
            display: flex;
            cursor: pointer;
            transition: all 300ms ease;
            position: relative;
        }

        .left .sidebar .menu-item h3, .left .sidebar .menu-item span{
            padding-top: 2rem;
            padding-bottom: 2rem;
            color: var(--color-gray);
        }
        
        .left .sidebar .menu-item:hover{
            background: var(--color-light);
        }
        
        .left .sidebar .menu-item i{
            font-size: 1.4rem;
            color: var(--color-gray);
            margin-left: 2rem;
            position: relative;
        }
        
        .left .sidebar i .notification-count{
            background: var(--color-danger);
            color: white;
            font-size: 0.7rem;
            width: fit-content;
            border-radius: 0.8rem;
            padding: 0.1rem 0.4rem;
            position: absolute;
            top: -0.2rem;
            right: -0.3rem;
        }
        
        .left .sidebar h3{
            margin-left: 1.5rem;
            font-size: 1rem;
        }
        
        .left .sidebar .active{
            background: var(--color-light);
        }
        
        .left .sidebar .active i, .left .sidebar .active h3{
            color: var(--color-primary);
        }
        
        .left .sidebar .active::before{
            content: "";
            display: block;
            width: 0.5rem;
            height: 100%;
            position: absolute;
            background: var(--color-primary);
        } 
        
        .left .sidebar .menu-item:first-child.active{
            border-top-left-radius: var(--card-border-radius);
            overflow: hidden;
        }
        
        .left .sidebar .menu-item:last-child.active{
            border-bottom-left-radius: var(--card-border-radius);
            overflow: hidden;
        }
        
        .left .btn{
            margin-top: 1rem;
            width: 100%;
            text-align: center;
            padding: 1rem 0;
        }
        
        /* ==================== MIDDLE ==================== */
        
        /* ------------------- CREATE POST ------------------- */
        .create-post {
            width: 100%;
            align-items: center;
            justify-content: space-between;
            background: var(--color-white);
            padding:  0.4rem var(--card-padding);
            border-radius: var(--card-border-radius);
        }
        
        .create-post .uil{
            color: var(--color-primary);
            font-size: 1.9rem; 
            margin-left: 0rem;
        }
        
        .uil:hover{
            color: var(--color-primary);
            cursor: pointer;
        }

        .create-post div{
            display: flex;    
        }

        .create-post h4{
            margin: 0.5rem;
        }
        
        input[type="text"]{
            justify-self: start;
            width: 70%;
            padding-left: 1rem;
            white-space: pre;
            background: var(--color-secondary);
            border-radius: var(--card-border-radius);
            height: 2.5rem;
            color: var(--color-dark);
        }

        .create-post textarea{
            justify-self: start;
            width: 100%;            
            padding-left: 1rem;
            background: var(--color-secondary);
            border-radius: var(--card-border-radius);
            height: 5rem;
            color: var(--color-dark);
        }
        .middle{
            height: 180vh;
            width: calc(100% - 38vw);
            overflow: auto;
        }
        
        .middle .feeds .feed{
            /* position: relative; */
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            padding: var(--card-padding);
            margin: 1rem 0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .comment_card{
            /* position: absolute; */
            width: 95%;
            margin-left: auto;
            /* background: var(--color-dark); */
            right: 0;
            margin-top: 1rem;            
        }
        
        .middle .feeds .head{
            display: flex;
            justify-content: space-between;
        }
        
        .user{
            display: flex;
            gap: 1rem;
        }
        
        .middle .feed .photo{
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 0.7rem 0;
        }

        
        
        .action-button{
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.4rem;
            margin: 0.6rem;
        }
        
        .reactions{
            background: transparent;
            font-size: large;
            display: flex;
            flex-direction: row;
            margin-right: 8px;
        }

        .reactions:hover{
            cursor: pointer;
        }

        .middle .feed-content{
            margin: 1.2rem;
            color: var(--color-black);
        }
        
        main .container .right{
            margin-top: 1rem;
            height: max-content;  
            width: 20vw;
        }

        .interaction-buttons{
            display: flex;
        }
        
        .right .heading{
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .category-group{
            display: flex;
            flex-direction: column;
        }
        
        .category-group div{
            display: flex;
            align-items: center;
            padding: 0.8rem;
        }
        
        .category-group div input{
            cursor: pointer;
            margin-right: 1rem;
            
        }
        .category-group div input::after{
            color: var(--color-primary);
            font-size: large;
        
        }
        
        
        .right .categories{
            display: flex;
            flex-direction: column;
            background: var(--color-white);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
            font-size: 1.4rem;
            height: max-content;           
        }
        nav .uil{
            font-size: 1.5rem;
            display: none;
        }

        
        @media (max-width: 1176px) { 
            nav .uil{
                display: block;
            } 

            .search-bar{
                display: none;
            }

            .left,
            .right{
                display: none;
                position: absolute;                
                min-width: 15rem;
                margin-top: 2rem;
                background: var(--color-light);
                z-index: 2
            }
            .left{
                left: 0;
            }   
            .right{
                right: 0;
            }        


            .middle{
                position: absolute;
                width: auto;
                z-index: 1;
                margin-top: 2rem;
            }           
        }


    </style> -->
</head>
<body>

  <!--========================== NAV BAR ==========================-->
    <nav>

        <div class="container">
            <i class="uil uil-bars"></i>

            <h2 class="logo">
                Forum
            </h2>

            <div class="search-bar">
                <i class="uil uil-search"></i>
                <input type="search" placeholder="Not functional yet">
            </div>
            
            <div class="create">
                {{if .UserName}}
                <a href="/logout" class="btn btn-primary" >Logout</a>                
                {{else}}
                <a href="/login" class="btn btn-primary" >Login</a>
                <a href="/register" class="btn btn-primary" >Register</a>
                {{end}}
            </div>
            <i class="uil uil-clipboard-alt mobRight"></i>            
        </div>
        
    </nav>
  <!--========================== END OF NAV BAR ==========================-->

    <!----------------------- MAIN ----------------------->
    <main>
        <div class="container">
            
            <!--====================== LEFT ======================-->
            <div class="left">

                <!------------ PROFILE ------------>
                {{ if .UserName }}
                <div class="profile-card">
                    <!-- Profile Photo Section -->
                    
                    <div class="profile-photo">
                        {{ if .ProfilePicture }}
                        <img src="data:{{ .ContentType }};base64,{{ .ProfilePicture }}" alt="Profile Picture">
                        {{ else }}
                        <div class="initials">{{ .Initial }}</div>                        
                        {{ end }}
                    </div>

                    <!-- User Info Section -->
                    <div class="handle">
                        <h4>{{ .UserName }}</h4>
                    </div>
                

                    {{if not .ProfilePicture}}
                    <p class="text-muted">Upload your profile picture</p>                        
                    {{end}}       
                    
                
                    <!-- Profile Picture Upload Form -->
                    <form action="/upload-profile" method="POST" enctype="multipart/form-data" class="upload-form" id="profile-upload-form">

                        <label for="profile-upload" class="upload-label">
                            <i class="uil uil-camera" id="profile_pic">Change Photo</i> 
                        </label>
                        <input type="file" id="profile-upload" name="profile_picture" accept="image/*">
                        <button type="submit">Upload</button>
                    </form>
                </div>
                {{ else }}
                <div class="profile-card">
                    <div class="profile-photo">
                        <div class="initials">G</div>
                    </div>
                    <div class="handle">
                        <h4>Guest Mode</h4>
                        <p class="text-muted">Please login or create an account</p>
                    </div>
                </div>
                {{ end }}
                
            
            <!------------ END OF PROFILE ------------>

                {{ if .UserName}}
                <!------------- SIDEBAR ------------->
                <div class="sidebar">
                    <!-- <a class="menu-item active"> -->
                        <a href="/allposts" class="menu-item {{if eq .ViewType "all"}} active{{end}}">
                        <span>
                            <i class="uil uil-home"></i>                            
                        </span>
                        <h3>Home</h3>
                    </a>

                    <a href="/my_posts" class="menu-item {{if eq .ViewType "mine"}} active{{end}}">
                        <span><i class="uil uil-pen"></i></span>  
                        <h3>My Posts</h3>  
                    </a>
            
                    <a href="/liked_posts" class="menu-item {{if eq .ViewType "liked"}} active{{end}}">                     
                        <span><i class="uil uil-thumbs-up"></i></span>
                        <h3 >Liked Posts</h3>
                    </a>
                </div>
                <!-------------END OF  SIDEBAR ------------->
                
                <div class="sidebar">
                    <div class="create-post"> 
                        <div class="heading">
                            <i class="uil uil-plus-circle"></i><h2>create Post</h2>                              
                        </div> 
                        
                        <!------------------- CREATE POST ------------------->
                        <form action="/post" method="POST" id="createPostForm" enctype="multipart/form-data" class="create-post">
                            
    
                            <input type="text" name="post_title" placeholder="Enter title of your post" id="create-post">
                            <h4>Content</h4>
                            <div>
                                <textarea  name="post_content" placeholder="what's on your mind" id="create-post"></textarea>
                            </div>
                            
                            <label for="media"><i class="uil uil-image-plus"></i> </label>
                            <input type="file" id="media" name="media" accept=".jpg,.jpeg,.png,.gif,.mp4,.mov,.webm" hidden>
                            <span id="file-name">Choose Image to Post.</span>   
                            
                            
                            <h3>Choose the Categories:</h3>
                            <div class="category-group"> 
                                {{range .Categories}}
                                <div class="category-option">                
                                    <input type="checkbox" id="cat-{{.ID}}" name="categories" value="{{.Name}}">
                                    <label for="cat-{{.ID}}"><h5>{{.Name}}</h5></label>
                                </div>
                                {{end}}                                                
                            </div>
                            <input type="submit" value="Post" class="btn btn-primary">
                        </form>
                        <!------------------- END OF CREATE POST ------------------->
                    </div>
                    
                </div>               
                {{end}}
            </div>

            <!--====================== END OF LEFT ======================-->



            <!--====================== MIDDLE ======================-->
      <div class="middle">      

        

        <!---------------------- FEEDS/POSTS ---------------------->
                <div class="feeds">
                    {{range .Posts}}
                    <!---------------------- FEED 1 ---------------------->
                    <div class="feed" id="{{.PostId}}">

                        <!--======= user  =======-->
                        <div class="head">                            
                            <div class="user">
                                <div class="profile-photo">
                                    <!-- <img src="images/profile-10.jpg"> -->
                                    <div class="initials">{{ .Initial }}</div>
                                </div>

                                <div class="info">
                                    <h3>{{.UserName}}</h3>
                                    <small> {{.CreatedAt}}</small>
                                </div>                                
                            </div>
                            <span class="edit">                                    
                                <i class="uil uil-ellipsis-h"></i>
                            </span>                            
                        </div>
                        <!--======= END OF user  =======-->

                        
                        <!--======= POST CONTENT  =======-->
                        <div class="feed-content">
                            <h3>{{.Title}}</h3>
                            <pre>{{.Content}}</pre>
                        </div>
                        <!--======= END OF POST CONTENT  =======-->

                        {{if .MediaString}}
                        <!--======= POST IMAGE  =======-->
                        <div class="photo">
                            {{if or (eq .ContentType "image/jpeg") (eq .ContentType "image/png") (eq .ContentType "image/gif")}}
                            <img src="data:{{.ContentType}};base64,{{.MediaString}}" alt="Post image" class="post-media">
                            {{end}}
                        </div>
                        <!--======= END OF POST IMAGE  =======-->
                        {{end}}

                        <div class="action-button">

                            <!------------ LIKES AND DISLIKES ------------>
                            <form class="like-form" action="/likes" method="POST">
                                <div class="interaction-buttons">
                                    <input type="hidden" name="id" value="{{.PostId}}">
                                    <input type="hidden" name="item_type" value="post">
                                    <button type="submit" name="type" value="like" class="reactions">
                                        <i class="uil uil-thumbs-up"></i>
                                        <h6 id="" class="like">{{.Likes}}</h6>                                    
                                    </button>
                                    
                                    <button type="submit" name="type" value="dislike" class="reactions">
                                        <i class="uil uil-thumbs-down"></i>
                                        <h6 class="dislike">{{.Dislikes}}</h6>
                                    </button>                                                                                                
                                </div>
                            </form>                         
                            

                            <!--======= comment button =======-->
                            <div class="comment">
                                <span><i class="uil uil-comment-alt-dots" id="{{.PostId}}"></i></span>
                                <span>{{.CommentsLenght}}</span>
                            </div>
                            <!--======= END OF comment button =======-->
                        </div>
                            
                        <!------------ END OF LIKES AND DISLIKES ------------>

                       

                        <div class="comments" style="display: none;" id="post-{{.PostId}}">                    
                             <!----------------- Comment Form ----------------->
                            <form action="/add_comment" method="POST" class="comment-form" id="comments-{{.ID}}">
                                <input type="hidden" name="post_id" value="{{.PostId}}">
                                <input type="text" name="content" placeholder="Add a comment...">    
                                <input type="submit" value="Comment" class="btn btn-primary" >
                            </form>
                            <!----------------- END OF Comment Form ----------------->

                            {{range .Comments}}
                            <div class="comment_card">

                                <!--============== user Profile ==============-->
                                <div class="head">                                    
                                    <div class="user">
                                        <div class="profile-photo">
                                            <!-- <img src="images/profile-10.jpg"> -->
                                            <div class="initials">{{ .Initial }}</div>
                                        </div>
        
                                        <div class="info">
                                            <h3>{{.UserName}}</h3>
                                            <small>Dubai, 15minute ago</small>
                                        </div>                                
                                    </div>
                                </div>
                                <!--============== End Of user Profile  ==============-->



                                <!--======= comment CONTENT  =======-->
                                <div class="feed-content">
                                    <p>{{.Content}}</p>
                                </div>
                                <!--======= END OF comment CONTENT  =======-->



                                <div class="action-button">

                                    <!------------ LIKES AND DISLIKES ------------>
                                    <form class="like-form" action="/likes" method="POST">
                                        <div class="interaction-buttons">
                                            <input type="hidden" name="id" value="{{.ID}}">
                                            <input type="hidden" name="item_type" value="comment">
                                            <button type="submit" name="type" value="like" class="reactions">
                                                <i class="uil uil-thumbs-up"></i>
                                                <h6 id="" class="like">{{.Likes}}</h6>                                    
                                            </button>
                                            
                                            <button type="submit" name="type" value="dislike" class="reactions">
                                                <i class="uil uil-thumbs-down"></i>
                                                <h6 class="dislike">{{.Dislikes}}</h6>
                                            </button>                                                                                                
                                        </div>
                                    </form>
                                    <span><h6 class="uil reply-btn" id="{{.ID}}">Reply {{.RepliesLenght}}</h6></span>
                                    
                                </div>

                                

                                <div id="reply-{{.ID}}" style="display: none;">
                                    <p>Comment ID {{.ID}}</p>

                                    <form action="/add_reply" method="POST" class="reply-form" id="comments-{{.ID}}">
                                        <input type="hidden" name="parent_comment_id" value="{{.ID}}">
                                        <input type="text" name="content" placeholder="Add a reply...">
                                        <input type="submit" value="Reply" class="btn btn-primary">
                                    </form>


                                    {{range .Replies}}
                                    <div class="comment_card">

                                        <!--============== user Profile ==============-->
                                        <div class="head">                                        
                                            <div class="user">
                                                <div class="profile-photo">
                                                    <!-- <img src="images/profile-10.jpg"> -->
                                                    <div class="initials">{{ .Initial }}</div>
                                                </div>
                
                                                <div class="info">
                                                    <h3>{{.UserName}}</h3>
                                                    <small>Dubai, 15minute ago</small>
                                                </div>                                
                                            </div>                                   
                                        </div>
                                        <!--============== End OF user Profile ==============-->
                                        

                                        <!--======= comment CONTENT  =======-->
                                        <div class="feed-content">
                                            <p>{{.Content}}</p>
                                        </div>
                                        <!--======= END OF comment CONTENT  =======-->


                                        <div class="action-button">

                                            <!------------ LIKES AND DISLIKES ------------>

                                            <form class="like-form" action="/likes" method="POST">
                                                <div class="interaction-buttons">
                                                    <input type="hidden" name="id" value="{{.ID}}">
                                                    <input type="hidden" name="item_type" value="comment">
                                                    <button type="submit" name="type" value="like" class="reactions">
                                                        <i class="uil uil-thumbs-up"></i>
                                                        <h6 id="" class="like">{{.Likes}}</h6>                                    
                                                    </button>
                                                    
                                                    <button type="submit" name="type" value="dislike" class="reactions">
                                                        <i class="uil uil-thumbs-down"></i>
                                                        <h6 class="dislike">{{.Dislikes}}</h6>
                                                    </button>                                                                                                
                                                </div>
                                            </form>
                                            
                                            <span><h6 class="uil reply-btn" id="{{.ID}}">Reply {{.RepliesLenght}}</h6></span>
                                        </div>

                                        <!-- <form action="/add_reply" method="POST" class="reply-form" id="comments-{{.ID}}">
                                            <input type="hidden" name="parent_comment_id" value="{{.ID}}">
                                            <input type="text" name="content" placeholder="Add a comment...">
                                            <input type="submit" value="Reply" class="btn btn-primary">
                                        </form> -->

                                    </div>
                                    {{end}}

                                </div>

                                

                            </div>
                            {{end}}
                        </div>
                        
                    </div>
                    <!---------------------- END OF FEED 1 ---------------------->
                    {{end}}
                </div>
        <!---------------------- END OF FEEDS/POSTS ---------------------->
                        </div>

            <!--====================== RIGHT ======================-->
            <div class="right">

                <div class="categories" style="box-shadow: 2px 4px 6px rgba(0, 0, 0, 0.281);">
                    <div class="heading">
                        <h4> Filter by categories</h4>
                    </div>

                    <!---------------------- Categories ---------------------->
                    <form action="/filtered_posts" method="POST" id="filterposts">
                    <div class="category-group">  
                        {{range .Categories}}
                        <div class="category-option">                
                            <input type="checkbox" id="cat-{{.ID}}" name="filteredcategories" value="{{.Name}}">
                            <label for="cat-{{.ID}}"><h5>{{.Name}}</h5></label>
                        </div>
                        {{end}}                                               
                    </div>
                    </form>
                    <!---------------------- END OF Categories ---------------------->
                </div>

                
            </div>
            <!--====================== END OF RIGHT ======================-->
        </div>
    </main>
  <!----------------------- END OF MAIN ----------------------->
</body>
<script>

    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
    });


    document.querySelector(".uil-bars").addEventListener("click", function() {
        let leftElement = document.querySelector(".left"); 
        leftElement.style.display = leftElement.style.display === "block" ? "none" : "block";
    });

    document.querySelector(".uil-clipboard-alt").addEventListener("click", function() {
        let rightElement = document.querySelector(".right");
        rightElement.style.display = rightElement.style.display === "block" ? "none" : "block";
    });   
    

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".uil-comment-alt-dots").forEach(icon => {
            icon.addEventListener("click", function () {
                let commentId = this.id; 
                let commentElement = document.getElementById("post-" + commentId);
                console.log("Comment btn clicked and ID = ", commentId)
                
                console.log("Post", commentId, "clicked")

                if (commentElement) {
                    commentElement.style.display = commentElement.style.display === "block" ? "none" : "block";
                }
            });
        });

        document.querySelectorAll(".reply-btn").forEach(btn => {
            btn.addEventListener("click", function () {                
                let replyId = this.id; 
                let replyElement = document.getElementById("reply-" + replyId);
                console.log("reply btn clicked and ID = ", replyId)
                
                if (replyElement) {
                    replyElement.style.display = replyElement.style.display === "block" ? "none" : "block";
                }
            });
        });

        document.querySelectorAll('input[name="filteredcategories"]').forEach(btn =>{
            btn.addEventListener("click", filterByCategories);
        });
        
    });


    // Handle post creation form submission
    document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const response = await fetch('/post', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                console.log('post created')
                alert('Post created successfully!');
                window.location.href = '/allposts';
            } else if (response.status === 401) {
                alert('Failed to create post: user not logged in.');
                window.location.href = '/login';
            } else {
                alert('Failed to create post.');
                // window.location.reload();
            }
        });

        // Handle like/dislike form submissions
        // Like/dislike handler for both posts and comments
       // Like/dislike handler for both posts and comments
    document.addEventListener('DOMContentLoaded', function() {
        // Find all like/dislike forms
        const likeForms = document.querySelectorAll('form.like-form').forEach(form => {
            form.addEventListener('submit', async function(e) {
                // Prevent the default form submission
                e.preventDefault();
                
                // Create a new FormData object from the form
                const formData = new FormData(this);
                
                // Add the clicked button's value explicitly
                // In modern browsers, we can use e.submitter to get the clicked button
                if (e.submitter) {
                    formData.set('type', e.submitter.value);
                } else {
                    // Fallback for older browsers - try to determine which button was clicked
                    const clickedButton = document.activeElement;
                    if (clickedButton && clickedButton.getAttribute('value')) {
                        formData.set('type', clickedButton.getAttribute('value'));
                    }
                }
                
                // Log the form data to confirm
                console.log('Form data being sent:');
                for (let pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }
                
                const itemId = formData.get('id');
                const itemType = formData.get('item_type');
                const actionType = formData.get('type'); // 'like' or 'dislike'
                
                // Reference to the buttons that contain the counts
                const likeButton = this.querySelector('button[value="like"]');
                const dislikeButton = this.querySelector('button[value="dislike"]');
                const likeCountElement = likeButton.querySelector('.like');
                const dislikeCountElement = dislikeButton.querySelector('.dislike');
                
                // Send AJAX request
                fetch('/likes', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    // First check if the response is JSON
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        // It's JSON, so parse it
                        return response.json().then(data => {
                            return { status: response.status, data, isJson: true };
                        });
                    } else {
                        // Not JSON, get text instead
                        return response.text().then(text => {
                            return { status: response.status, text, isJson: false };
                        });
                    }
                })
                .then(result => {
                    console.log('Response:', result);
                    
                    if (result.status === 200 && result.isJson) {
                        // Success with JSON data
                        const data = result.data;
                        // Update the UI with new counts
                        if (data.likes !== undefined) {
                            likeCountElement.textContent = data.likes;
                        }
                        if (data.dislikes !== undefined) {
                            dislikeCountElement.textContent = data.dislikes;
                        }
                        
                        const clickedButton = actionType === 'like' ? likeButton : dislikeButton;
                        clickedButton.classList.add('active-reaction');
                        setTimeout(() => {
                            clickedButton.classList.remove('active-reaction');
                        }, 500);
                    } else if (result.status === 401) {
                        alert('Please log in to like/dislike posts');
                        window.location.href = '/login';
                    } else {
                        // Handle other error cases
                        const errorMessage = result.isJson && result.data.error 
                            ? result.data.error 
                            : 'Failed to process like/dislike';
                        console.error('Error response:', result.isJson ? result.data : result.text);
                        alert(errorMessage);
                    }
                })
                .catch(error => {
                    console.error('Network or parsing error:', error);
                    alert('An error occurred while processing your request');
                });
            });
        });
    });
        
    //filter posts by categories
    async function filterByCategories() {
        const checkboxes = document.querySelectorAll('input[name="filteredcategories"]:checked');
        
        
        const selectedCategories = Array.from(checkboxes).map(checkbox => checkbox.value);

        console.log("Categories Sent:", selectedCategories, selectedCategories.length); 

        try {
            const response = await fetch("/filtered_posts", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ categories: selectedCategories }),
            });

            const data = await response.json();
            console.log("Filtered Data:", data);
            if (selectedCategories.length === 0){
                data[0] = "all"
            }
            filter(data)
        } catch (error) {
            console.error("Error filtering:", error);
        }
    }

    function filter(data) {

        document.querySelectorAll(".feed").forEach(feed => {                   

            if (data[0] === "all"){
                feed.style.display = "block"
            }else{
                if (data.includes(feed.id )){
                    feed.style.display = "block"
                }else{
                    feed.style.display = "none"
                }
            }
        })
    }


    


    // Handle comment form submissions
    document.querySelectorAll('.comment-form').forEach(form => {
        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new URLSearchParams(new FormData(event.target));

            try {
                const response = await fetch('/add_comment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (response.ok) {
                    alert('Comment created successfully');
                    window.location.reload();
                } else if (response.status === 401) {
                    alert('Failed to comment: user not logged in.');
                    window.location.href = '/login';
                } else {
                    alert('Failed to comment.');
                }
            } catch (error) {
                console.error('Request failed:', error);
            }
        });
    });

    // Handle reply form submissions
    document.querySelectorAll('.reply-form').forEach(form => {
        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new URLSearchParams(new FormData(event.target));

            try {
                const response = await fetch('/add_reply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (response.ok) {
                    alert('Comment created successfully');
                    window.location.reload();
                } else if (response.status === 401) {
                    alert('Failed to comment: user not logged in.');
                    window.location.href = '/login';
                } else {
                    alert('Failed to comment.');
                }
            } catch (error) {
                console.error('Request failed:', error);
            }
        });
    });

    //profile 
    document.getElementById('profile-upload').addEventListener('change', function() {        
        let fileName = this.files.length ? this.files[0].name : "No file selected";
        document.getElementById("profile_pic").textContent = "Change Photo to "+fileName;
    });

    document.getElementById("media").addEventListener("change", function () {
        let fileName = this.files.length ? this.files[0].name : "No file selected";
        document.getElementById("file-name").textContent = fileName;
    });

</script>
</html>